\documentclass{beamer}
\usepackage[latin1]{inputenc}
\usetheme{boxes}
\title[Regexes in Python]{Regular Expressions in Python Tutorial}
\author{Michelle Fullwood}
\date{PyLadies Meetup Aug 2013}
\usepackage{color}
\newsavebox{\mysavebox}
\usepackage{listings}

\usepackage{verbdef}

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\lstset{ %
  backgroundcolor=\color{white},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}
  basicstyle=\ttfamily\footnotesize,        % the size of the fonts that are used for the code
  keywordstyle=\bfseries,
  identifierstyle=\color{red},     % object names
  commentstyle=\rmfamily\itshape, % italic comments
  stringstyle=\slshape,           % strings
  breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
  breaklines=true,                 % sets automatic line breaking
  captionpos=b,                    % sets the caption-position to bottom
  commentstyle=\color{mygreen},    % comment style
  deletekeywords={...},            % if you want to delete keywords from the given language
  escapeinside={\%*}{*)},          % if you want to add LaTeX within your code
  extendedchars=true,              % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
  frame=single,                    % adds a frame around the code
  keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  keywordstyle=\color{blue},       % keyword style
  language=Python,                 % the language of the code
  morekeywords={*,...},            % if you want to add more keywords to the set
  numbers=none,                    % where to put the line-numbers; possible values are (none, left, right)
  numbersep=5pt,                   % how far the line-numbers are from the code
  numberstyle=\tiny\color{mygray}, % the style that is used for the line-numbers
  rulecolor=\color{black},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
  showstringspaces=false,          % underline spaces within strings only
  showtabs=false,                  % show tabs within strings adding particular underscores
  stepnumber=2,                    % the step between two line-numbers. If it's 1, each line will be numbered
  stringstyle=\color{mymauve},     % string literal style
  tabsize=2,                       % sets default tabsize to 2 spaces
%  title=\lstname                   % show the filename of files included with \lstinputlisting; also try caption instead of title
}



\begin{document}

\begin{frame}
\titlepage
\end{frame}


\begin{lrbox}{\mysavebox}
\begin{lstlisting}
PCOD   QTY   DEPT    COST
A169   100   Micro   0.58
PDA1   1     Xray    600.00
X280   5     ER      199.99
...
\end{lstlisting}
\end{lrbox}

\begin{frame}{Motivating regular expressions}

{\bf Scenario:} You're evaluating Acme Company's products for a hospital.
You're given a text file containing purchase records from Acme.
Looking through the text file, however, you see that purchases from other companies
are included as well, with no mention of which ones come from which!

\vspace{1.5em}
{\usebox{\mysavebox}}
\vspace{1em}

Luckily, you know that Acme's product codes consist of one
uppercase letter followed by three digits.

\end{frame}


\begin{frame}{Motivating regular expressions}

So you get to work with a script:

\lstinputlisting[language=Python]{code_for_slides/slide2.py}

It's a bit clunky, but it works.

\end{frame}

\begin{lrbox}{\mysavebox}
\begin{lstlisting}
'...The gloves(P180) felt sticky...'
'...The X701 vacuum cleaner really sucked!...'
\end{lstlisting}
\end{lrbox}

\begin{frame}{Motivating regular expressions}

The next step in your evaluation is to collate evaluations
emailed to you by hospital staff. These were free text,
so you need to extract the product codes from within them
to know which evaluation refers to which product.

\vspace{1.5em}
{\usebox{\mysavebox}}
\vspace{1em}

You might be able to think of ways to program this,
but really...

\begin{center}
\textcolor{red}{It's time to bust out regular expressions.}
\end{center}

\end{frame}

\begin{frame}{Motivating regular expressions}

What we want is a way to simply search for ``one uppercase letter
followed by three digits''. We can do this using (1) a regular
expression and (2) the \lstinline$search$ function provided
by Python's \lstinline$re$ module:

\vspace{1em}
\lstinputlisting[language=Python]{code_for_slides/slide4.py}

\end{frame}

\begin{frame}{Just what are regular expressions, anyway?}

Regular expressions are strings that describe other sets of strings.

\bigskip

Some simple things we can do with regular expressions:
\begin{itemize}
 \item Match sets of characters
 \begin{itemize}
   \item Metacharacters  \lstinline$\\w, \\s, \\d$ 
   \item Character sets  \lstinline$[A-Z], [AGCT], [^AGCT]$
 \end{itemize}
 \item Repeat things
 \begin{itemize}
   \item A specific number of times \lstinline$^[3,5], ?$
   \item An unlimited number of times \lstinline$*,+$
 \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}{Plan for today}

We'll learn:
\begin{itemize}
 \item The pattern language for regular expressions
 \item The Python \lstinline$re$ functions that allow us to work with regexes
\end{itemize}

How to practise the code as we go along:
\begin{itemize}
 \item iPython
   \begin{itemize}
    \item Install iPython
    \item Clone this repo from Github % TODO
    \item Run \lstinline$ipython notebook$ from the command line
    \item A browser window will automatically open
    \item Select the only notebook
   \end{itemize}
 \item Online
   \begin{itemize}
    \item Enter regexes and strings into \lstinline$http://www.pythonregex.com/$
   \end{itemize}
\end{itemize}

\end{frame}

\begin{frame}{Metacharacters}

Metacharacters are pre-defined sets of characters.
 \begin{itemize}
  \item \lstinline$.$ matches ANY character*
  \item \lstinline$\\w$ matches alphanumeric characters and underscore \_
  \item \lstinline$\\d$ matches digits 0 through 9
  \item \lstinline$\\s$ matches whitespace characters
    \begin{itemize}
     \item Spaces 
     \item Tabs \lstinline$\\t$
     \item Newlines \lstinline$\\n\\r$
     \item (Escape sequences \lstinline$\\f\\v$)
    \end{itemize}
 \end{itemize}

 \bigskip
 $\rightarrow$ Exercise 1
\end{frame}

\begin{frame}{Defining sets of characters}
 \begin{itemize}
  \item List characters individually
    \begin{itemize}
      \item \lstinline$[AGCT]$ matches one character A, G, C or T.
      \item \lstinline$[\s\d]$ matches one whitespace character or digit
    \end{itemize}
  \item Define a range of characters
    \begin{itemize}
      \item \lstinline$[A-T]$ matches one character between A and T.
      \item \lstinline$[1-7]$ matches one digit between 1 and 7.
      \item Ranges as defined by ASCII or Unicode tables
      \item You can combine ranges: \lstinline$[a-cA-C]$
    \end{itemize}
 \end{itemize}

 \bigskip
 $\rightarrow$ Exercise 2

\end{frame}

\begin{frame}{Defining where a regular expression applies}

We can say a regex has to be at the start or the end of the string, or at word boundaries,
with more special characters.

\begin{itemize}
 \item \lstinline$^$ -- beginning of line
 \item \lstinline$\$$ -- end of line 
 \item \lstinline$\\b$ -- word boundary
\end{itemize}

Examples: $\rightarrow$ Exercise 3
\begin{itemize}
 \item \lstinline$^Hallo\$$
 \item \lstinline$\\bHallo\\b$
\end{itemize}

\end{frame}

\verbdef{\specialchartext}{\^ \$ \. \\}

\begin{frame}{Escaping characters}

$\rightarrow$ Exercise 4

\bigskip

Why didn't the regex(es) work? (Discuss.)

\begin{itemize}
 \item When using characters that also have a special meaning, we have to escape them with a backslash
 \item \specialchartext
 \item Exception: within character sets [], metacharacters have their regular meaning, except backslashes.*
\end{itemize}

\end{frame}

\begin{frame}{Defining complements of a set}

Sometimes it's easier to define a set of characters as ``everything other than X''.

\begin{itemize}
  \item \lstinline$\\S$ -- all non-whitespace characters
  \item \lstinline$\\W$ -- all non-alphanumeric characters (also excludes underscore)
  \item \lstinline$\\D$ -- all non-numeric characters
  \item \lstinline$[^A-D]$ -- all characters other than A, B, C, D
\end{itemize}

\bigskip
$\rightarrow$ Exercise 5

\end{frame}

\begin{frame}{Repeating things}

So far, whenever we've wanted to match, say, three digits, we've just been writing
\lstinline$\\d\\d\\d$. This could easily get old if we want to match thirty or a thousand digits.
It gets impossible when we want to match any arbitrary number of digits.
Fortunately, regular expressions let us express this very succinctly.

\end{frame}

\begin{frame}{Repeating things}

\begin{itemize}
 \item \lstinline$*$ means 0 or more times
 \item \lstinline$+$ means 1 or more times
 \item \lstinline$?$ means 0 or 1 times
 \item \lstinline$\{n\}$ means n times exactly
 \item \lstinline$\{m,\}$ means m or more times
 \item \lstinline$\{m,n\}$ means m--n times
 \item Example: \lstinline$.*$ matches anything
 \item Example: \lstinline$[a-c]\{3\}$ matches 'abc' etc
\end{itemize}

\bigskip
$\rightarrow$ Exercise 6

\end{frame}

\begin{frame}{Alternatives}

Sometimes you want to say match this OR that.
You can do that with the | operator.

\begin{itemize}
  \item \lstinline$Alex|Bill|Conrad$ matches any of these three names
\end{itemize}

Sometimes there can be confusion about what | refers to.
In such cases, put brackets around the alternatives.

\begin{itemize}
  \item \lstinline$Jim and (Alex|Bill|Conrad)$ matches 'Jim and Alex', 'Jim and Bill', etc
\end{itemize}


\end{frame}


\end{document}